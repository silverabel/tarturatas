<!DOCTYPE html>
<html>
<head>
<style>
  body {
    font-size: 3rem;
  }
  
  select {
    width: 100%;
    height: 10rem;
    font-size: 3rem;
  }
</style>
</head>
<body>
<script>
const KEY = 'stationIds';
const stations = [];

const make = (n) => document.createElement(n);

const getStation = (id) => {
  const s =
    stations.find(({sId}) => sId === id)
    || make('p');
};

const getIds = () => JSON.parse(
  localStorage.getItem(KEY) || '[]'
);

const url = 'https://api.ratas.tartu.ee/cxf/am/station/';

const body = document
  .getElementsByTagName('body')[0];

const select = make('select');
body.append(select);
    
select.onchange = () => {
  const id = select
    .options[select.selectedIndex]
    .station
    .id;
    
  localStorage.setItem(
    KEY,
    JSON.stringify([...getIds(), id]));
};

fetch(url + 'map/search', {
  method: 'POST',
  body: JSON.stringify({
    isPublic: true,
    limit: -1,
  }),
  headers: {
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(({ results }) =>
    results.forEach(station => {
      const o = make('option');
      o.innerText = station.description;
      o.station = station;

      select.appendChild(o);
  }));
  
getIds().forEach(async id => {
  const b = await
    (await fetch(url + id)).json();

  const p = make('p');
  
  p.innerHTML = b.description;
      
  b.lockedCycleTypeCount.forEach(({
    cycleType,
    countPrimary,
    countSecondary,
  }) => p.innerHTML += `
    ${cycleType}
    ${countPrimary} +
    ${countSecondary}`
  );
  
  body.append(p);
});
</script>
</body>
</html>
